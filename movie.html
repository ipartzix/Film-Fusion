<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FilmFusion | AI Matchmaker</title>
  <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
  <style>
    body { background-color: #0f172a; }
    #recommendations::-webkit-scrollbar { height: 6px; }
    #recommendations::-webkit-scrollbar-thumb { background: #6366f1; border-radius: 10px; }
    .movie-card { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); opacity: 0; transform: translateY(20px); }
    .movie-card.show { opacity: 1; transform: translateY(0); }
    .movie-card:hover { transform: scale(1.05); z-index: 10; }
    .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
  </style>
</head>
<body class="p-6 text-white font-sans">

<div class="text-center mb-12">
  <h1 class="text-6xl font-black bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-cyan-400 mb-2">FilmFusion</h1>
  <p class="text-slate-400">Discover your next favorite movie using Gemini AI</p>
</div>

<div class="max-w-2xl mx-auto flex flex-col md:flex-row gap-4 mb-16">
  <input id="movie-input" type="text" placeholder="Type a movie you love..." class="w-full p-4 rounded-2xl bg-slate-800/50 border border-slate-700 focus:border-indigo-500 outline-none transition-all" />
  <button id="ai-recommend-btn" class="px-10 py-4 rounded-2xl font-bold bg-indigo-600 hover:bg-indigo-500 shadow-lg shadow-indigo-500/20 transition-all active:scale-95">Explore</button>
</div>

<div id="loading" class="hidden text-center mb-12">
  <div class="inline-block w-8 h-8 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div>
  <p class="mt-2 text-indigo-400 font-medium italic">Curating your list...</p>
</div>

<div id="hero" class="hidden max-w-6xl mx-auto mb-16 h-[450px] rounded-[2rem] overflow-hidden relative shadow-2xl border border-white/10">
  <div id="hero-bg" class="absolute inset-0 bg-cover bg-center"></div>
  <div class="absolute inset-0 bg-gradient-to-t from-slate-950 via-slate-950/40 to-transparent"></div>
  <div class="absolute bottom-10 left-10 right-10">
    <span class="px-3 py-1 bg-indigo-600 rounded-full text-[10px] font-bold uppercase tracking-widest mb-4 inline-block">Perfect Match</span>
    <h2 id="hero-title" class="text-5xl font-bold mb-2"></h2>
    <p id="hero-genres" class="text-slate-300 mb-4"></p>
    <div id="hero-rating" class="text-2xl font-bold text-yellow-400"></div>
  </div>
</div>

<div class="max-w-7xl mx-auto">
  <h2 class="text-2xl font-bold mb-8 flex items-center gap-3">
    <span class="w-2 h-6 bg-indigo-500 rounded-full"></span> Similar Recommendations
  </h2>
  <div id="recommendations" class="flex gap-6 overflow-x-auto pb-10 snap-x"></div>
</div>

<script>
  const movieInput = document.getElementById("movie-input");
  const recommendBtn = document.getElementById("ai-recommend-btn");
  const loading = document.getElementById("loading");
  const recommendations = document.getElementById("recommendations");
  const hero = document.getElementById("hero");
  const heroBg = document.getElementById("hero-bg");
  const heroTitle = document.getElementById("hero-title");
  const heroGenres = document.getElementById("hero-genres");
  const heroRating = document.getElementById("hero-rating");

  async function getAIRecommendations() {
    const query = movieInput.value.trim();
    if (!query) return;

    recommendations.innerHTML = "";
    loading.classList.remove("hidden");
    hero.classList.add("hidden");

    try {
      const res = await fetch("/api/movie", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query }),
      });
      const aiMovies = await res.json();

      // PARALLEL FETCHING: Fetch all TMDB data at once
      const moviePromises = aiMovies.map(async (m) => {
        const searchRes = await fetch(`/api/search?title=${encodeURIComponent(m.title)}`);
        return searchRes.ok ? await searchRes.json() : null;
      });

      const movieResults = await Promise.all(moviePromises);
      const validMovies = movieResults.filter(m => m !== null);

      validMovies.forEach((movie, i) => {
        const poster = movie.poster_path ? `https://image.tmdb.org/t/p/w500${movie.poster_path}` : "[https://via.placeholder.com/300x450](https://via.placeholder.com/300x450)";
        const rating = movie.vote_average ? movie.vote_average.toFixed(1) : "N/A";
        const genres = (movie.genre_names || []).join(" • ");

        if (i === 0) {
          heroBg.style.backgroundImage = `url(https://image.tmdb.org/t/p/original${movie.backdrop_path})`;
          heroTitle.textContent = movie.title;
          heroGenres.textContent = genres;
          heroRating.textContent = `⭐ ${rating} / 10`;
          hero.classList.remove("hidden");
        }

        const card = document.createElement("div");
        card.className = "movie-card min-w-[240px] snap-start glass rounded-3xl p-4";
        card.style.transitionDelay = `${i * 50}ms`;

        card.innerHTML = `
          <img src="${poster}" class="w-full h-72 object-cover rounded-2xl mb-4 shadow-lg">
          <h3 class="font-bold text-lg truncate">${movie.title}</h3>
          <p class="text-xs text-slate-400 mb-2">${genres}</p>
          <div class="flex items-center justify-between">
            <span class="text-yellow-400 text-sm font-bold">⭐ ${rating}</span>
            <span class="text-[10px] text-slate-500">${movie.release_date?.split('-')[0] || ''}</span>
          </div>
        `;
        recommendations.appendChild(card);
        setTimeout(() => card.classList.add('show'), 50);
      });
    } catch (err) {
      console.error(err);
      alert("Something went wrong. Check your API keys and Console.");
    } finally {
      loading.classList.add("hidden");
    }
  }

  recommendBtn.addEventListener("click", getAIRecommendations);
</script>
</body>
</html>